!function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){e.exports=i(1)},function(e,t,i){"use strict";i.r(t);const n=jQuery;jQuery(function(){new class{constructor(e,t){this.config=e,this.logger=t,wp.media&&this.run()}run(){const e=this,t=wp.media.View.extend({className:"ibc-iframe-container",initialize(){this.$el.html('<div class="ibc-spinner"><div class="sk-chasing-dots"><div class="sk-child sk-dot1"></div><div class="sk-child sk-dot2"></div></div></div><iframe allow="clipboard-write" class="ibc-iframe ibc-rsp"></iframe>');const t=this.$el.find(".ibc-spinner");this.$el.find(".ibc-iframe").attr("src",e.config.url).on("load",()=>t.hide())}});["Post","Select"].forEach(e=>this.extend(e,t))}extend(e,t){const i=this,r=wp.media.view.l10n,o=wp.media.view.MediaFrame[e];wp.media.view.MediaFrame[e]=o.extend({browseRouter(e){e.set({upload:{text:r.uploadFilesTitle,priority:20},browse:{text:r.mediaLibraryTitle,priority:40},ibc:{text:"IntelligenceBank",priority:60}})},bindHandlers(){o.prototype.bindHandlers.apply(this,arguments),this.on("content:create:ibc",this.ibcContent,this)},ibcContent(r){const o=this;n(window).off("message").on("message",t=>{i.log("Message received: "),i.log(t.originalEvent.data);let r={};i.log("Trying to decode JSON");try{r=JSON.parse(t.originalEvent.data)}catch(e){return void i.log("Unable to decode message","red")}if(i.log("Decoded successfully, action: "+r.action),"resource_download"===r.action){i.log("Downloading media");try{r=i.parseIbData(r)}catch(e){return void i.log(e.message)}o.content.mode("browse"),i.uploadMedia(r)}else if("Post"===e&&"resource_link"===r.action){i.log("Inserting media as a link");try{r=i.parseIbData(r)}catch(e){return void i.log(e.message)}o.setState("embed");const e=n(".media-embed"),t=o.state();e.find("#embed-url-field").val(r.url).trigger("input"),t.listenTo(t,"change:loading",function(){if(this.get("loading"))return;const t=r.description?r.description:r.name;setTimeout(()=>e.find('[data-setting="alt"]').val(t).trigger("change"),100)})}else i.log("Unknown action")}),r.view=new t({controller:this,model:this.state().props})}})}parseIbData(e){const t={};return[{name:"name",source:["name","filename","description"],required:!0},{name:"type",source:["type"],required:!0},{name:"filename",source:["filename","origfilename"],required:!0},{name:"filesize",source:["filesize"],required:!0},{name:"url",source:["download_url","url"],required:!0},{name:"description",source:["description","name"],default:""},{name:"_aid",source:["_aid"],default:""}].forEach(i=>{if(i.source.forEach(n=>{t[i.name]||e[n]&&(t[i.name]=e[n])}),!t[i.name]){if(i.required)throw`Field ${i.name} is required`;i.default&&(t[i.name]=i.default)}}),t}uploadMedia(e){const t=this,i={title:e.name,uploading:!0,filename:e.filename,loaded:0,size:e.filesize,percent:0,type:e.type.split("/")[0],subtype:e.type.split("/")[1],meta:{},artist:"",album:""},r=wp.media.model.Attachment.create(i);wp.Uploader.queue.add(r);const o={name:e.filename,attachment:r},a={action:"ibc_upload",_wpnonce:this.config.nonce,data:e};n.post({url:ajaxurl,data:a,success:e=>t.mediaResponse(e,o),error:(e,i,n)=>t.mediaUploadError("Upload error",n,o)})}mediaResponse(e,t){if(!_.isObject(e)||_.isUndefined(e.success))return void this.mediaUploadError("Upload error",null,t);if(!e.success)return void this.mediaUploadError(e.message,e.data,t);const i=t.attachment;["file","loaded","size","percent"].forEach(e=>i.unset(e)),i.set(_.extend(e.data,{uploading:!1})),wp.media.model.Attachment.get(e.data.id,i),wp.Uploader.queue.all(e=>!e.get("uploading"))&&wp.Uploader.queue.reset()}mediaUploadError(e,t,i){i.attachment&&i.attachment.destroy(),wp.Uploader.errors.unshift({message:e||"Upload error",data:t,file:i})}log(e,t="lightblue"){this.logger.log(e,"IB Connector: ",t)}}(window.ibc,new class{constructor(e){this.opts=Object.assign({enabled:!0,prefix:"",color:"blue"},e)}log(e,t="",i=""){if(!this.opts.enabled)return null;t=t||this.opts.prefix,i=i||this.opts.color;const n=`[${(new Date).toISOString().split("T")[1].slice(0,-1)}] `;return console.log(`%c${n}${t}${e}`,`color: ${i}; font-weight: bold`),null}}({enabled:!!window.ibc.log}))})}]);